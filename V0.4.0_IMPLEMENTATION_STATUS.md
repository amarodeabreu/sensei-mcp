# v0.4.0 Implementation Status

**Current Progress:** ~40% Complete
**Last Updated:** 2025-01-22

---

## ‚úÖ COMPLETED (40%)

### Feature #1: Session Analytics & Insights (100% DONE)
- ‚úÖ Created `analytics.py` with SessionAnalyzer class
- ‚úÖ Implemented comprehensive insights (persona stats, context/mode distribution, decision metrics)
- ‚úÖ Added `get_session_insights()` MCP tool
- ‚úÖ Supports time_range filtering (all_time, last_7_days, last_30_days)
- ‚úÖ Multiple output formats (markdown, JSON, text)
- ‚úÖ Tested and working

**Files:**
- `src/sensei_mcp/analytics.py` (400 LOC)
- `src/sensei_mcp/server.py` (added tool)

### Feature #2: Interactive Persona Discovery (30% DONE)
- ‚úÖ Enhanced SkillLoader to extract v0.4.0 metadata (examples, use_when, related, quick_tip)
- ‚úÖ Updated BasePersona with new properties
- ‚ö†Ô∏è **IN PROGRESS**: Enhanced list_available_skills() - NEXT STEP
- ‚ùå TODO: CLI demo mode
- ‚ùå TODO: Context hints in get_engineering_guidance

**Files Modified:**
- `src/sensei_mcp/personas/loader.py` (added v0.4.0 field extraction)
- `src/sensei_mcp/personas/base.py` (added v0.4.0 properties)

---

## üöß IN PROGRESS (Next Steps)

### Immediate: Enhance list_available_skills()

**Current State:**
```python
@mcp.tool()
def list_available_skills(category: str = None) -> str:
    # Returns basic name + description
```

**Target State:**
```python
@mcp.tool()
def list_available_skills(
    category: str = None,
    format: str = "standard"  # "standard", "detailed", "quick"
) -> str:
    # Returns:
    # - standard: name + description (current)
    # - detailed: + examples + use_when + related
    # - quick: one-line quick_tip per persona
```

**Implementation (server.py lines ~602-634):**
```python
if format == "detailed":
    for persona in personas:
        result.append(f"\n## {persona.name.replace('-', ' ').title()}")
        result.append(f"{persona.description}\n")

        # NEW: Examples
        if persona.examples:
            result.append(f"**Example queries:**")
            for ex in persona.examples[:3]:
                result.append(f"- \"{ex}\"")
            result.append("")

        # NEW: When to use
        if persona.use_when:
            result.append(f"**Use when:** {persona.use_when}\n")

        # NEW: Related personas
        if persona.related_personas:
            result.append(f"**Works well with:** {', '.join(persona.related_personas)}\n")

        if persona.expertise_areas:
            result.append(f"**Expertise:** {', '.join(persona.expertise_areas[:5])}\n")

elif format == "quick":
    for persona in personas:
        result.append(f"- **{persona.name}**: {persona.quick_tip}")
```

---

## ‚ùå TODO (60% Remaining)

### Feature #2: Interactive Persona Discovery (Remaining)

#### A. CLI Demo Mode
**File:** `src/sensei_mcp/__main__.py` (create if doesn't exist)

**Implementation:**
```python
def demo_mode():
    """Interactive demo of persona capabilities."""
    scenarios = [
        {
            'query': "Should we migrate to microservices?",
            'expected_personas': ['snarky-senior-engineer', 'pragmatic-architect'],
            'context': 'architectural'
        },
        {
            'query': "Production database is down!",
            'expected_personas': ['incident-commander', 'site-reliability-engineer'],
            'context': 'crisis'
        },
        # Add 3-5 more scenarios
    ]

    for i, scenario in enumerate(scenarios, 1):
        print(f"\n{'='*60}")
        print(f"Scenario {i}: {scenario['context'].upper()}")
        print(f"{'='*60}")
        print(f"Query: {scenario['query']}")
        print(f"Personas: {', '.join(scenario['expected_personas'])}")
        # Show sample synthesis

        input("\nPress Enter to continue...")
```

**CLI Integration:**
```python
# In __main__.py
if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--demo', action='store_true')
    args = parser.parse_args()

    if args.demo:
        demo_mode()
    else:
        # Normal MCP server
        from .server import mcp
        mcp.run()
```

**Effort:** 2-3 hours (100-150 LOC)

---

#### B. Context Hints
**File:** `src/sensei_mcp/server.py` - modify `get_engineering_guidance()`

**Implementation:**
```python
# In get_engineering_guidance(), after context detection:
if mode == "auto":
    detected_context = detector.get_primary_context(query)
    selected_personas = orchestrator.select_personas(query, mode=mode, ...)

    # NEW: Generate hint if low persona match
    if len(selected_personas) < 2:
        hint = _generate_context_hint(query, detected_context, persona_registry)
        synthesis_with_hint = f"üí° Context Hint: {hint}\n\n{result['synthesis']}"
        return synthesis_with_hint

def _generate_context_hint(query, context, registry):
    """Suggest better personas based on query keywords."""
    # Match query keywords to persona expertise
    suggestions = []
    for persona in registry.get_all().values():
        score = persona.relevance_score(query)
        if score > 0.5:
            suggestions.append(persona.name)

    if suggestions:
        return f"This looks like a {context} question. Consider: {', '.join(suggestions[:3])}"
    return ""
```

**Effort:** 1-2 hours (50-75 LOC)

---

### Feature #3: Team Collaboration Features

#### A. Export Consultation Reports
**File:** `src/sensei_mcp/exporter.py` (NEW)

**Implementation:**
```python
class ConsultationExporter:
    """Export consultations in various formats."""

    @staticmethod
    def export_consultation(
        consultation: Consultation,
        format: str = "markdown"
    ) -> str:
        """Export single consultation as markdown/JSON/PDF."""
        if format == "markdown":
            return f"""
# Consultation Report

**ID:** {consultation.id}
**Date:** {consultation.timestamp}
**Mode:** {consultation.mode}
**Context:** {consultation.context}

## Query
{consultation.query}

## Personas Consulted
{', '.join(consultation.personas_consulted)}

## Synthesis
{consultation.synthesis}

{'**Linked Decision:** ' + consultation.decision_id if consultation.decision_id else ''}
"""
        elif format == "json":
            import json
            return json.dumps(asdict(consultation), indent=2)
```

**MCP Tool (server.py):**
```python
@mcp.tool()
def export_consultation(
    consultation_id: str,
    session_id: str = "default",
    project_root: str = None,
    format: str = "markdown"
) -> str:
    """Export a single consultation as shareable report."""
    session = session_mgr.get_or_create_session(session_id, project_root)

    # Find consultation
    consultation = next(
        (c for c in session.consultations if c.id == consultation_id),
        None
    )

    if not consultation:
        return f"‚ùå Consultation {consultation_id} not found"

    from .exporter import ConsultationExporter
    return ConsultationExporter.export_consultation(consultation, format)
```

**Effort:** 3-4 hours (150-200 LOC)

---

#### B. Export Session Summary
**MCP Tool (server.py):**
```python
@mcp.tool()
def export_session_summary(
    session_id: str = "default",
    project_root: str = None,
    format: str = "markdown",
    include: List[str] = ["decisions", "consultations", "constraints"]
) -> str:
    """
    Export comprehensive session summary for team sharing.

    Generates Architecture Decision Records (ADRs), consultation history,
    and active constraints/patterns.
    """
    session = session_mgr.get_or_create_session(session_id, project_root)

    report = [f"# Session Summary: {session_id}"]
    report.append(f"\n**Generated:** {datetime.now().isoformat()}")
    report.append(f"**Session Started:** {session.started_at}\n")

    if "decisions" in include:
        report.append("\n## Architecture Decisions\n")
        for dec in session.decisions:
            report.append(f"### {dec.description}")
            report.append(f"**Category:** {dec.category}")
            report.append(f"**Rationale:** {dec.rationale}")
            report.append(f"**Date:** {dec.timestamp}\n")

    if "consultations" in include:
        report.append("\n## Consultation History\n")
        for cons in session.consultations[-10:]:  # Last 10
            report.append(f"### {cons.query}")
            report.append(f"**Personas:** {', '.join(cons.personas_consulted)}")
            report.append(f"**Date:** {cons.timestamp}\n")

    if "constraints" in include:
        report.append("\n## Active Constraints\n")
        for constraint in session.active_constraints:
            report.append(f"- {constraint}")

    return "\n".join(report)
```

**Effort:** 2-3 hours (100-150 LOC)

---

## üìä Effort Summary

| Component | Status | Effort | LOC |
|-----------|--------|--------|-----|
| Session Analytics | ‚úÖ Done | - | 400 |
| Enhanced list_available_skills() | üöß In Progress | 1h | 50 |
| CLI Demo Mode | ‚ùå TODO | 2-3h | 150 |
| Context Hints | ‚ùå TODO | 1-2h | 75 |
| Export Consultation | ‚ùå TODO | 3-4h | 200 |
| Export Session Summary | ‚ùå TODO | 2-3h | 150 |
| **Comprehensive Testing** | ‚ùå TODO | 4-6h | 300 |
| **Documentation** | ‚ùå TODO | 2-3h | - |
| **TOTAL REMAINING** | - | **15-21h** | **925 LOC** |

---

## üéØ Next Session Action Plan

**Priority Order:**
1. ‚úÖ Complete enhanced `list_available_skills()` (30 min)
2. ‚úÖ Add `export_consultation()` tool (2-3 hours)
3. ‚úÖ Add `export_session_summary()` tool (2-3 hours)
4. ‚úÖ Add context hints to `get_engineering_guidance()` (1-2 hours)
5. ‚úÖ Create CLI demo mode (2-3 hours)
6. ‚úÖ Write comprehensive tests (4-6 hours)
7. ‚úÖ Update documentation (2-3 hours)

**Total Estimated Time:** 15-21 hours of focused development

---

## üöÄ When to Ship v0.4.0

**Minimum Viable v0.4.0:**
- ‚úÖ Session Analytics (DONE)
- ‚úÖ Enhanced list_available_skills() with detailed format
- ‚úÖ Export consultation reports
- ‚úÖ Export session summaries
- ‚úÖ Basic tests
- ‚úÖ Updated README

**Nice-to-Have (can be v0.4.1):**
- CLI demo mode
- Context hints
- Comprehensive test coverage
- Session merge

**Recommendation:** Ship v0.4.0 when we have Analytics + Exports + Tests (est. 8-10 more hours)

---

Made with üé≠ by the Sensei Multi-Persona Team
